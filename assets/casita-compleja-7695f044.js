import{P as S}from"./pg-event-8842ce7a.js";class C{constructor(t,n){this.expectedWord=t,this.availableChars=n}binaryStringToChar(t){const n=parseInt(t,2);return this.availableChars[n]!==void 0?this.availableChars[n]:"_"}getBitsNeeded(){return Math.ceil(Math.log2(this.availableChars.length))}binaryStringToWord(t){const n=this.getBitsNeeded(),r=[];for(let e=0;e<t.length;e+=n){const s=t.slice(e,e+n);r.push(this.binaryStringToChar(s))}return r.join("")}wordToBinaryString(t){const n=this.getBitsNeeded(),r=[];for(const e of t){const s=e,o=this.availableChars.indexOf(s).toString(2).padStart(n,"0");r.push(o)}return r.join("")}getBinaryStringFromSelects(t){const n=t.querySelectorAll(".binary-select__select"),r=this.getBitsNeeded(),e=[];for(let s=0;s<n.length;s+=r){const i=[];for(let o=0;o<r;o++)i.push(n[s+o].value);e.push(i)}return e}updatePreview(t,n){const r=n.flat().join(""),s=this.binaryStringToWord(r).split("");t.innerHTML="",s.map(i=>{const o=document.createElement("div");o.classList.add("char-preview");const l=document.createElement("span");l.classList.add("char-preview__char"),l.textContent=i,o.appendChild(l),t.appendChild(o)})}generateBinarySelects(t,n){this.expectedWord.split("").map(e=>{const s=document.createElement("div");s.classList.add("binary-select__char");const i=this.getBitsNeeded();for(let o=0;o<i;o++){const l=document.createElement("select");l.classList.add("binary-select__select"),["0","1"].forEach(d=>{const c=document.createElement("option");c.value=d,c.text=d,l.appendChild(c)}),l.addEventListener("change",d=>{this.toggleSelect(l),n(this.getBinaryStringFromSelects(t))}),s.appendChild(l)}t.appendChild(s)})}toggleSelect(t){t.value==="1"?t.classList.add("binary-select__select--selected"):t.classList.remove("binary-select__select--selected")}setBinarySelects(t,n){const r=t.querySelectorAll(".binary-select__select");for(let e=0;e<n.length;e++){const s=n[e];for(let i=0;i<s.length;i++)r[e*s.length+i].value=s[i]}r.forEach(e=>{this.toggleSelect(e)})}}const v=a=>{var g;const t=["?","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n=a.expectedWord.toUpperCase(),r=new S,e=new C(n,t);e.generateBinarySelects(a.container,d=>{const c=d.flat().join(""),h=e.binaryStringToWord(c);if(a.isFreeMode){e.updatePreview(a.preview,d);return}h!==n?r.postToPg({event:"FAILURE",message:"¡Oh no! Esa no es la palabra correcta. Inténtalo de nuevo.",reasons:[],state:JSON.stringify({selectors:c})}):r.postToPg({event:"SUCCESS",message:"Bien hecho! Has encontrado la letra correcta.",reasons:[],state:JSON.stringify({selectors:c})}),e.updatePreview(a.preview,d)});let s=[];if(r.getValues(),(g=r.data.state)!=null&&g.selectors?s=r.data.state.selectors.match(/.{1,2}/g):s=e.wordToBinaryString(a.initialWord?a.initialWord.toUpperCase():n.replace(/[A-Z]/g,"?")).match(/.{1,2}/g),e.setBinarySelects(a.container,s),e.updatePreview(a.preview,s),!a.onHouseChange)return;const i=a.container.querySelectorAll(".binary-select__select"),o=e.getBitsNeeded(),l=Array.from({length:Math.ceil(i.length/o)},(d,c)=>{const h=Array.from(i).slice(c*o,(c+1)*o),p=e.binaryStringToChar(h.map(u=>u.value).join(""));return{index:(c+1).toString(),htmlElement:h[0].closest(".binary-select__char"),isOK:p===n[c],actualChar:p}});a.onHouseChange(l)},b=a=>{v({expectedWord:"?".repeat(a.housesAmount),isFreeMode:!0,container:a.container,preview:a.preview,onHouseChange:a.onHouseChange})};export{v as C,b as F};
