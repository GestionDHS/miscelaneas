import{P as S}from"./pg-event-8842ce7a.js";class p{constructor(t,s){this.expectedWord=t,this.availableChars=s}binaryStringToChar(t){const s=parseInt(t,2);return this.availableChars[s]!==void 0?this.availableChars[s]:"_"}getBitsNeeded(){return Math.ceil(Math.log2(this.availableChars.length))}binaryStringToWord(t){const s=this.getBitsNeeded(),r=[];for(let n=0;n<t.length;n+=s){const e=t.slice(n,n+s);r.push(this.binaryStringToChar(e))}return r.join("")}wordToBinaryString(t){const s=this.getBitsNeeded(),r=[];for(const n of t){const e=n,a=this.availableChars.indexOf(e).toString(2).padStart(s,"0");r.push(a)}return r.join("")}getBinaryStringFromSelects(t){const s=t.querySelectorAll(".binary-select__select"),r=this.getBitsNeeded(),n=[];for(let e=0;e<s.length;e+=r){const i=[];for(let a=0;a<r;a++)i.push(s[e+a].value);n.push(i)}return n}updatePreview(t,s){const r=s.flat().join(""),n=this.binaryStringToWord(r);t.innerHTML=n}generateBinarySelects(t,s){this.expectedWord.split("").map(n=>{const e=document.createElement("div");e.classList.add("binary-select__char");const i=this.getBitsNeeded();for(let a=0;a<i;a++){const c=document.createElement("select");c.classList.add("binary-select__select"),["0","1"].forEach(h=>{const l=document.createElement("option");l.value=h,l.text=h,c.appendChild(l)}),c.addEventListener("change",h=>{this.toggleSelect(c),s(this.getBinaryStringFromSelects(t))}),e.appendChild(c)}t.appendChild(e)})}toggleSelect(t){t.value==="1"?t.classList.add("binary-select__select--selected"):t.classList.remove("binary-select__select--selected")}setBinarySelects(t,s){const r=t.querySelectorAll(".binary-select__select");for(let n=0;n<s.length;n++){const e=s[n];for(let i=0;i<e.length;i++)r[n*e.length+i].value=e[i]}r.forEach(n=>{this.toggleSelect(n)})}}const y=o=>{var h;const t=["?","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],s=o.expectedWord.toUpperCase(),r=new S;let n=!1;const e=new p(s,t);e.generateBinarySelects(o.container,l=>{const d=l.flat().join(""),g=e.binaryStringToWord(d);if(o.isFreeMode){e.updatePreview(o.preview,l);return}g!==s?(r.postToPg({event:"FAILURE",message:"¡Oh no! Esa no es la palabra correcta. Inténtalo de nuevo.",reasons:[],state:JSON.stringify({selectors:d})}),n=!1):(r.postToPg({event:"SUCCESS",message:"Bien hecho! Has encontrado la letra correcta.",reasons:[],state:JSON.stringify({selectors:d})}),n=!0),e.updatePreview(o.preview,l)});let i=[];if(r.getValues(),(h=r.data.state)!=null&&h.selectors?i=r.data.state.selectors.match(/.{1,2}/g):i=e.wordToBinaryString(o.initialWord?o.initialWord.toUpperCase():s.replace(/[A-Z]/g,"?")).match(/.{1,2}/g),e.setBinarySelects(o.container,i),e.updatePreview(o.preview,i),!o.onHouseChange)return;const a=o.container.querySelectorAll(".binary-select__select"),c=e.getBitsNeeded(),u=Array.from({length:Math.ceil(a.length/c)},(l,d)=>{const g=Array.from(a).slice(d*c,(d+1)*c);return{index:(d+1).toString(),htmlElement:g[0].closest(".binary-select__char"),isOK:n}});o.onHouseChange(u)},b=o=>{y({expectedWord:"?".repeat(o.housesAmount),isFreeMode:!0,container:o.container,preview:o.preview,onHouseChange:o.onHouseChange})};export{y as C,b as F};
