import{P as L}from"./pg-event-8842ce7a.js";const s={houseContainer:null,messageElement:null,lights:[],onLightsChange:t=>{},availableChars:[" ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z",".",",","!","?"],setLightsValues:t=>{for(let e=0;e<t.length;e++)s.lights[e].value=t[e];s.updateMessage()},translateLightsToMessage:t=>{let e="";for(let l of t)e+=l.value;let a=parseInt(e,2);return s.availableChars[a]},translateMessageToLights:t=>{let a=s.availableChars.indexOf(t).toString(2),i=s.lights.length-a.length;for(let n=0;n<i;n++)a="0"+a;return a.split("").map(n=>parseInt(n))},updateText:t=>{const e=s.availableChars[t];if(e===void 0){s.messageElement.textContent="?";return}s.messageElement.textContent=e},updateMessage:()=>{window.scrollTo(0,1e4);let t="";for(let a of s.lights){let l=a.value;t+=l,l==="1"?a.classList.add("binary-select__select--selected"):a.classList.remove("binary-select__select--selected")}let e=parseInt(t,2);s.updateText(e)},createLights:()=>{let t=Math.ceil(Math.log2(s.availableChars.length)),e=document.createElement("div");for(let a=0;a<t;a++){let l=document.createElement("SELECT");l.classList.add("binary-select__select"),l.addEventListener("change",()=>{s.onLightsChange(s.lights),s.updateMessage()});let i=document.createElement("OPTION");i.innerHTML="0",i.value="0",l.appendChild(i);let n=document.createElement("OPTION");n.innerHTML="1",n.value="1",l.appendChild(n),e.appendChild(l),s.lights.push(l)}s.houseContainer.appendChild(e)},init:(t,e,a)=>{s.houseContainer=t,s.messageElement=e,s.onLightsChange=a,s.createLights()}};class f{constructor(e,a){this.duration=e,this.callback=a,this.timer=null}start(){this.stop(),this.timer=setTimeout(()=>{this.callback(),this.start()},this.duration)}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}reset(){this.stop(),this.start()}}const T=t=>{const{expectedLetter:e,house:a,letter:l}=t;let i=!1,n=!1;const m=(o,h)=>o.translateLightsToMessage(h)===e,u=(o,h)=>{if(!i){console.log("No hay cambios pendientes.");return}const c=m(o,h),p=c?"¡Felicidades! Has encontrado la letra correcta.":"¡Oh no! Esa no es la letra correcta. Inténtalo de nuevo.";g.postToPg({event:c?"SUCCESS":"FAILURE",message:p,reasons:[],state:JSON.stringify({lights:Array.from(h).map(C=>parseInt(C.value))})}),i=!1,n=c},g=new L,r=Object.create(s),d=new f(8e3,()=>u(r,r.lights));if(d.start(),r.init(a,l,o=>{t.isFreeMode||(i=!0,d.reset(),m(r,o)===n)||u(r,o)}),g.getValues(),g.data.lights)r.setLightsValues(g.data.lights);else{const o=t.initialLetter||" ";r.setLightsValues(r.translateMessageToLights(o))}};export{T as C};
