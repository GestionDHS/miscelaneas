import{P as g}from"./pg-event-8842ce7a.js";class p{constructor(t,s){this.expectedWord=t,this.availableChars=s}binaryStringToChar(t){const s=parseInt(t,2);return this.availableChars[s]!==void 0?this.availableChars[s]:"_"}getBitsNeeded(){return Math.ceil(Math.log2(this.availableChars.length))}binaryStringToWord(t){const s=this.getBitsNeeded(),n=[];for(let e=0;e<t.length;e+=s){const r=t.slice(e,e+s);n.push(this.binaryStringToChar(r))}return n.join("")}wordToBinaryString(t){const s=this.getBitsNeeded(),n=[];for(const e of t){const r=e,o=this.availableChars.indexOf(r).toString(2).padStart(s,"0");n.push(o)}return n.join("")}getBinaryStringFromSelects(t){const s=t.querySelectorAll(".binary-select__select"),n=this.getBitsNeeded(),e=[];for(let r=0;r<s.length;r+=n){const a=[];for(let o=0;o<n;o++)a.push(s[r+o].value);e.push(a)}return e}updatePreview(t,s){const n=s.flat().join(""),e=this.binaryStringToWord(n);t.innerHTML=e}generateBinarySelects(t,s){this.expectedWord.split("").map(e=>{const r=document.createElement("div");r.classList.add("binary-select__char");const a=this.getBitsNeeded();for(let o=0;o<a;o++){const c=document.createElement("select");c.classList.add("binary-select__select"),["0","1"].forEach(l=>{const d=document.createElement("option");d.value=l,d.text=l,c.appendChild(d)}),c.addEventListener("change",l=>{this.toggleSelect(c),s(this.getBinaryStringFromSelects(t))}),r.appendChild(c)}t.appendChild(r)})}toggleSelect(t){t.value==="1"?t.classList.add("binary-select__select--selected"):t.classList.remove("binary-select__select--selected")}setBinarySelects(t,s){const n=t.querySelectorAll(".binary-select__select");for(let e=0;e<s.length;e++){const r=s[e];for(let a=0;a<r.length;a++)n[e*r.length+a].value=r[a]}n.forEach(e=>{this.toggleSelect(e)})}}const S=i=>{var a;const t=["?","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],s=i.expectedWord.toUpperCase(),n=new g,e=new p(s,t);e.generateBinarySelects(i.container,o=>{const c=o.flat().join(""),h=e.binaryStringToWord(c);if(i.isFreeMode){e.updatePreview(i.preview,o);return}h!==s?n.postToPg({event:"FAILURE",message:"¡Oh no! Esa no es la palabra correcta. Inténtalo de nuevo.",reasons:[],state:JSON.stringify({selectors:c})}):n.postToPg({event:"SUCCESS",message:"Bien hecho! Has encontrado la letra correcta.",reasons:[],state:JSON.stringify({selectors:c})}),e.updatePreview(i.preview,o)});let r=[];n.getValues(),(a=n.data.state)!=null&&a.selectors?r=n.data.state.selectors.match(/.{1,2}/g):r=e.wordToBinaryString(i.initialWord?i.initialWord.toUpperCase():s.replace(/[A-Z]/g,"?")).match(/.{1,2}/g),e.setBinarySelects(i.container,r),e.updatePreview(i.preview,r)},v=i=>{S({expectedWord:"?".repeat(i.housesAmount),isFreeMode:!0,container:i.container,preview:i.preview})};export{S as C,v as F};
