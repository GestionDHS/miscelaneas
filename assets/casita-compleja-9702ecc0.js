import{P as f}from"./pg-event-f7ab3da9.js";class _{constructor(t,s){this.expectedWord=t,this.availableChars=s}createUI(t,s,a,e){const n=a.flat().join(""),i=this.binaryStringToWord(n).split("");this.generateBinarySelects(t,e),this.createPreview(s,i)}binaryStringToChar(t){const s=parseInt(t,2);return this.availableChars[s]!==void 0?this.availableChars[s]:"_"}getBitsNeeded(){return Math.ceil(Math.log2(this.availableChars.length))}binaryStringToWord(t){const s=this.getBitsNeeded(),a=[];for(let e=0;e<t.length;e+=s){const n=t.slice(e,e+s);a.push(this.binaryStringToChar(n))}return a.join("")}wordToBinaryString(t){const s=this.getBitsNeeded(),a=[];for(const e of t){const n=e,i=this.availableChars.indexOf(n).toString(2).padStart(s,"0");a.push(i)}return a.join("")}getBinaryStringFromSelects(t){const s=t.querySelectorAll(".binary-select__select"),a=this.getBitsNeeded(),e=[];for(let n=0;n<s.length;n+=a){const o=[];for(let i=0;i<a;i++)o.push(s[n+i].value);e.push(o)}return e}createPreview(t,s){s.map(a=>{const e=document.createElement("div");e.classList.add("char-preview");const n=document.createElement("span");n.classList.add("char-preview__char"),n.textContent=a,e.appendChild(n),t.appendChild(e)})}updatePreview(t,s){const a=s.flat().join(""),n=this.binaryStringToWord(a).split(""),o=t.querySelectorAll(".char-preview__char");n.forEach((i,c)=>{o[c].textContent=i})}generateBinarySelects(t,s){this.expectedWord.split("").map(e=>{const n=document.createElement("div");n.classList.add("binary-select__char");const o=this.getBitsNeeded();for(let i=0;i<o;i++){const c=document.createElement("select");c.classList.add("binary-select__select"),["0","1"].forEach(h=>{const g=document.createElement("option");g.value=h,g.text=h,c.appendChild(g)}),c.addEventListener("change",h=>{this.toggleSelect(c),s(this.getBinaryStringFromSelects(t))}),n.appendChild(c)}t.appendChild(n)})}toggleSelect(t){t.value==="1"?t.classList.add("binary-select__select--selected"):t.classList.remove("binary-select__select--selected")}setBinarySelects(t,s){const a=t.querySelectorAll(".binary-select__select");for(let e=0;e<s.length;e++){const n=s[e];for(let o=0;o<n.length;o++)a[e*n.length+o].value=n[o]}a.forEach(e=>{this.toggleSelect(e)})}}const w=r=>{var h,g,y;const t="¡Bien hecho! Has encontrado la letra correcta.",s="¡Oh no! Esa no es la palabra correcta. Inténtalo de nuevo.",a=["?","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e=r.expectedWord.toUpperCase(),n=new f,o=new _(e,a),i=l=>{const d=o.getBitsNeeded();return Array.from({length:Math.ceil(l.length/d)},(v,u)=>{const S=Array.from(l).slice(u*d,(u+1)*d),C=o.binaryStringToChar(S.map(b=>b.value).join(""));return{index:(u+1).toString(),htmlElement:S[0].closest(".binary-select__char"),isOK:C===e[u],actualChar:C}})},c=l=>{const d=l.flat().join(""),v=o.binaryStringToWord(d);if(r.onHouseChange){const C=r.container.querySelectorAll(".binary-select__select"),b=i(C);r.onHouseChange(b)}if(r.isFreeMode){o.updatePreview(r.preview,l);return}const u=v!==e?"FAILURE":"SUCCESS",S=v!==e?r.failureMessage||s:r.successMessage||t;n.postToPg({event:u,message:S,reasons:[],state:JSON.stringify({selectors:d})}),o.updatePreview(r.preview,l)};let p=[];if(n.getValues(),p=((g=(h=n.data.state)==null?void 0:h.selectors)==null?void 0:g.match(/.{1,2}/g))||o.wordToBinaryString(((y=r.initialWord)==null?void 0:y.toUpperCase())||e.replace(/[A-Z]/g,"?")).match(/.{1,2}/g),o.createUI(r.container,r.preview,p,c),o.setBinarySelects(r.container,p),o.updatePreview(r.preview,p),r.onHouseChange){const l=r.container.querySelectorAll(".binary-select__select"),d=i(l);r.onHouseChange(d)}},B=r=>{w({expectedWord:"?".repeat(r.housesAmount),isFreeMode:!0,container:r.container,preview:r.preview,onHouseChange:r.onHouseChange})};export{w as C,B as F};
