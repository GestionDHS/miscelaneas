import{P as M}from"./pg-event-8842ce7a.js";const s={houseContainer:null,messageElement:null,lights:[],onLightsChange:e=>{},availableChars:[" ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z",".",",","!","?"],setLightsValues:e=>{for(let t=0;t<e.length;t++)s.lights[t].value=e[t];s.updateMessage()},translateLightsToMessage:e=>{let t="";for(let l of e)t+=l.value;let a=parseInt(t,2);return s.availableChars[a]},translateMessageToLights:e=>{let a=s.availableChars.indexOf(e).toString(2),o=s.lights.length-a.length;for(let n=0;n<o;n++)a="0"+a;return a.split("").map(n=>parseInt(n))},updateText:e=>{const t=s.availableChars[e];if(t===void 0){s.messageElement.textContent="?";return}s.messageElement.textContent=t},updateMessage:()=>{window.scrollTo(0,1e4);let e="";for(let a of s.lights){let l=a.value;e+=l,l==="1"?a.classList.add("binary-select__select--selected"):a.classList.remove("binary-select__select--selected")}let t=parseInt(e,2);s.updateText(t)},createLights:()=>{let e=Math.ceil(Math.log2(s.availableChars.length)),t=document.createElement("div");for(let a=0;a<e;a++){let l=document.createElement("SELECT");l.classList.add("binary-select__select"),l.addEventListener("change",()=>{s.onLightsChange(s.lights),s.updateMessage()});let o=document.createElement("OPTION");o.innerHTML="0",o.value="0",l.appendChild(o);let n=document.createElement("OPTION");n.innerHTML="1",n.value="1",l.appendChild(n),t.appendChild(l),s.lights.push(l)}s.houseContainer.appendChild(t)},init:(e,t,a)=>{s.houseContainer=e,s.messageElement=t,s.onLightsChange=a,s.createLights()}};class v{constructor(t,a){this.duration=t,this.callback=a,this.timer=null}start(){this.stop(),this.timer=setTimeout(()=>{this.callback(),this.start()},this.duration)}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}reset(){this.stop(),this.start()}}const E=e=>{const t="¡Felicidades! Has encontrado la letra correcta.",a="¡Oh no! Esa no es la letra correcta. Inténtalo de nuevo.",{expectedLetter:l,house:o,letter:n}=e;let c=!1,m=!1;const d=(r,h)=>r.translateLightsToMessage(h)===l,p=(r,h)=>{if(!c){console.log("No hay cambios pendientes.");return}const u=d(r,h),L=u?e.successMessage||t:e.failureMessage||a;g.postToPg({event:u?"SUCCESS":"FAILURE",message:L,reasons:[],state:JSON.stringify({lights:Array.from(h).map(f=>parseInt(f.value))})}),c=!1,m=u},g=new M,i=Object.create(s),C=new v(8e3,()=>p(i,i.lights));if(C.start(),i.init(o,n,r=>{e.isFreeMode||(c=!0,C.reset(),d(i,r)===m)||p(i,r)}),g.getValues(),g.data.lights)i.setLightsValues(g.data.lights);else{const r=e.initialLetter||" ";i.setLightsValues(i.translateMessageToLights(r))}};export{E as C};
