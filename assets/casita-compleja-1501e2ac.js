import{P as f}from"./pg-event-f7ab3da9.js";class _{constructor(t,s){this.expectedWord=t,this.availableChars=s}createUI(t,s,a,e){const n=a.flat().join(""),i=this.binaryStringToWord(n).split("");this.generateBinarySelects(t,e),this.createPreview(s,i)}binaryStringToChar(t){const s=parseInt(t,2);return this.availableChars[s]!==void 0?this.availableChars[s]:"_"}getBitsNeeded(){return Math.ceil(Math.log2(this.availableChars.length))}binaryStringToWord(t){const s=this.getBitsNeeded(),a=[];for(let e=0;e<t.length;e+=s){const n=t.slice(e,e+s);a.push(this.binaryStringToChar(n))}return a.join("")}wordToBinaryString(t){const s=this.getBitsNeeded(),a=[];for(const e of t){const n=e,i=this.availableChars.indexOf(n).toString(2).padStart(s,"0");a.push(i)}return a.join("")}getBinaryStringFromSelects(t){const s=t.querySelectorAll(".binary-select__select"),a=this.getBitsNeeded(),e=[];for(let n=0;n<s.length;n+=a){const r=[];for(let i=0;i<a;i++)r.push(s[n+i].value);e.push(r)}return e}createPreview(t,s){s.map(a=>{const e=document.createElement("div");e.classList.add("char-preview");const n=document.createElement("span");n.classList.add("char-preview__char"),n.textContent=a,e.appendChild(n),t.appendChild(e)})}updatePreview(t,s){const a=s.flat().join(""),n=this.binaryStringToWord(a).split(""),r=t.querySelectorAll(".char-preview__char");n.forEach((i,c)=>{r[c].textContent=i})}generateBinarySelects(t,s){this.expectedWord.split("").map(e=>{const n=document.createElement("div");n.classList.add("binary-select__char");const r=this.getBitsNeeded();for(let i=0;i<r;i++){const c=document.createElement("select");c.classList.add("binary-select__select"),["0","1"].forEach(p=>{const h=document.createElement("option");h.value=p,h.text=p,c.appendChild(h)}),c.addEventListener("change",p=>{this.toggleSelect(c),s(this.getBinaryStringFromSelects(t))}),n.appendChild(c)}t.appendChild(n)})}toggleSelect(t){t.value==="1"?t.classList.add("binary-select__select--selected"):t.classList.remove("binary-select__select--selected")}setBinarySelects(t,s){const a=t.querySelectorAll(".binary-select__select");for(let e=0;e<s.length;e++){const n=s[e];for(let r=0;r<n.length;r++)a[e*n.length+r].value=n[r]}a.forEach(e=>{this.toggleSelect(e)})}}const w=o=>{var h,y;const t="¡Bien hecho! Has encontrado la letra correcta.",s="¡Oh no! Esa no es la palabra correcta. Inténtalo de nuevo.",a=["?","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e=o.expectedWord.toUpperCase(),n=new f,r=new _(e,a),i=l=>{const d=r.getBitsNeeded();return Array.from({length:Math.ceil(l.length/d)},(b,g)=>{const S=Array.from(l).slice(g*d,(g+1)*d),C=r.binaryStringToChar(S.map(v=>v.value).join(""));return{index:(g+1).toString(),htmlElement:S[0].closest(".binary-select__char"),isOK:C===e[g],actualChar:C}})},c=l=>{const d=l.flat().join(""),b=r.binaryStringToWord(d);if(o.onHouseChange){const C=o.container.querySelectorAll(".binary-select__select"),v=i(C);o.onHouseChange(v)}if(o.isFreeMode){r.updatePreview(o.preview,l);return}const g=b!==e?"FAILURE":"SUCCESS",S=b!==e?o.failureMessage||s:o.successMessage||t;n.postToPg({event:g,message:S,reasons:[],state:JSON.stringify({selectors:d})}),r.updatePreview(o.preview,l)};let u=[];n.getValues();const p=r.getBitsNeeded();if(u=(((h=n.data.state)==null?void 0:h.selectors)||r.wordToBinaryString(((y=o.initialWord)==null?void 0:y.toUpperCase())||e.replace(/[A-Z]/g,"?"))).match(new RegExp(`.{1,${p}}`,"g")),r.createUI(o.container,o.preview,u,c),r.setBinarySelects(o.container,u),r.updatePreview(o.preview,u),o.onHouseChange){const l=o.container.querySelectorAll(".binary-select__select"),d=i(l);o.onHouseChange(d)}},W=o=>{w({expectedWord:"?".repeat(o.housesAmount),isFreeMode:!0,container:o.container,preview:o.preview,onHouseChange:o.onHouseChange})};export{w as C,W as F};
