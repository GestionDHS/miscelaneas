import{P as T}from"./pg-event-f7ab3da9.js";const E=e=>{var t,s;return((t=e==null?void 0:e.data)==null?void 0:t.data)&&((s=e==null?void 0:e.data)==null?void 0:s.type)==="init"&&typeof e.data.data=="string"};async function b(e=5e3){return new Promise(t=>{const s=setTimeout(()=>{window.removeEventListener("message",l),t(null)},e);function l(i){E(i)&&(clearTimeout(s),window.removeEventListener("message",l),t(i.data.data))}window.addEventListener("message",l)})}const a={houseContainer:null,messageElement:null,lights:[],onLightsChange:e=>{},availableChars:[" ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z",".",",","!","?"],setLightsValues:e=>{for(let t=0;t<e.length;t++)a.lights[t].value=e[t];a.updateMessage()},translateLightsToMessage:e=>{let t="";for(let l of e)t+=l.value;let s=parseInt(t,2);return a.availableChars[s]},translateMessageToLights:e=>{let s=a.availableChars.indexOf(e).toString(2),i=a.lights.length-s.length;for(let n=0;n<i;n++)s="0"+s;return s.split("").map(n=>parseInt(n))},updateText:e=>{const t=a.availableChars[e];a.messageElement.textContent=t===void 0?"?":t},updateMessage:()=>{window.scrollTo(0,1e4);let e="";for(let s of a.lights){let l=s.value;e+=l,l==="1"?s.classList.add("binary-select__select--selected"):s.classList.remove("binary-select__select--selected")}let t=parseInt(e,2);a.updateText(t)},createLights:()=>{let e=Math.ceil(Math.log2(a.availableChars.length)),t=document.createElement("div");for(let s=0;s<e;s++){let l=document.createElement("SELECT");l.classList.add("binary-select__select"),l.addEventListener("change",()=>{a.onLightsChange(a.lights),a.updateMessage()});let i=document.createElement("OPTION");i.innerHTML="0",i.value="0",l.appendChild(i);let n=document.createElement("OPTION");n.innerHTML="1",n.value="1",l.appendChild(n),t.appendChild(l),a.lights.push(l)}a.houseContainer.appendChild(t)},init:(e,t,s)=>{a.houseContainer=e,a.messageElement=t,a.onLightsChange=s,a.createLights()}};class v{constructor(t,s){this.duration=t,this.callback=s,this.timer=null}start(){this.stop(),this.timer=setTimeout(()=>{this.callback(),this.start()},this.duration)}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}reset(){this.stop(),this.start()}}const O=async e=>{const t="¡Felicidades! Has encontrado la letra correcta.",s="¡Oh no! Esa no es la letra correcta. Inténtalo de nuevo.",{expectedLetter:l,house:i,letter:n}=e;let c=!1,d=!1;const m=(o,h)=>o.translateLightsToMessage(h)===l,p=(o,h)=>{if(!c){console.log("No hay cambios pendientes.");return}const u=m(o,h),C=u?e.successMessage||t:e.failureMessage||s;L.postToPg({event:u?"SUCCESS":"FAILURE",message:C,reasons:[],state:JSON.stringify({lights:Array.from(h).map(M=>parseInt(M.value))})}),c=!1,d=u},L=new T,r=Object.create(a),f=new v(8e3,()=>p(r,r.lights));f.start(),r.init(i,n,o=>{e.isFreeMode||(c=!0,f.reset(),m(r,o)===d)||p(r,o)}),L.getValues();let g=await b();if(g=g?JSON.parse(g):null,g&&g.lights&&g.data!=="not-started")r.setLightsValues(g.lights);else{const o=e.initialLetter||" ";r.setLightsValues(r.translateMessageToLights(o))}};export{O as C};
