import{P as v}from"./pg-event-8842ce7a.js";class y{constructor(t,n){this.expectedWord=t,this.availableChars=n}binaryStringToChar(t){const n=parseInt(t,2);return this.availableChars[n]!==void 0?this.availableChars[n]:"_"}getBitsNeeded(){return Math.ceil(Math.log2(this.availableChars.length))}binaryStringToWord(t){const n=this.getBitsNeeded(),r=[];for(let e=0;e<t.length;e+=n){const s=t.slice(e,e+n);r.push(this.binaryStringToChar(s))}return r.join("")}wordToBinaryString(t){const n=this.getBitsNeeded(),r=[];for(const e of t){const s=e,o=this.availableChars.indexOf(s).toString(2).padStart(n,"0");r.push(o)}return r.join("")}getBinaryStringFromSelects(t){const n=t.querySelectorAll(".binary-select__select"),r=this.getBitsNeeded(),e=[];for(let s=0;s<n.length;s+=r){const i=[];for(let o=0;o<r;o++)i.push(n[s+o].value);e.push(i)}return e}updatePreview(t,n){const r=n.flat().join(""),s=this.binaryStringToWord(r).split("");t.innerHTML="",s.map(i=>{const o=document.createElement("div");o.classList.add("char-preview");const c=document.createElement("span");c.classList.add("char-preview__char"),c.textContent=i,o.appendChild(c),t.appendChild(o)})}generateBinarySelects(t,n){this.expectedWord.split("").map(e=>{const s=document.createElement("div");s.classList.add("binary-select__char");const i=this.getBitsNeeded();for(let o=0;o<i;o++){const c=document.createElement("select");c.classList.add("binary-select__select"),["0","1"].forEach(d=>{const l=document.createElement("option");l.value=d,l.text=d,c.appendChild(l)}),c.addEventListener("change",d=>{this.toggleSelect(c),n(this.getBinaryStringFromSelects(t))}),s.appendChild(c)}t.appendChild(s)})}toggleSelect(t){t.value==="1"?t.classList.add("binary-select__select--selected"):t.classList.remove("binary-select__select--selected")}setBinarySelects(t,n){const r=t.querySelectorAll(".binary-select__select");for(let e=0;e<n.length;e++){const s=n[e];for(let i=0;i<s.length;i++)r[e*s.length+i].value=s[i]}r.forEach(e=>{this.toggleSelect(e)})}}const b=a=>{var i;const t=["?","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n=a.expectedWord.toUpperCase(),r=new v,e=new y(n,t);e.generateBinarySelects(a.container,o=>{const c=o.flat().join(""),g=e.binaryStringToWord(c);if(!a.onHouseChange)return;const d=a.container.querySelectorAll(".binary-select__select"),l=e.getBitsNeeded(),S=Array.from({length:Math.ceil(d.length/l)},(f,h)=>{const p=Array.from(d).slice(h*l,(h+1)*l),u=e.binaryStringToChar(p.map(C=>C.value).join(""));return{index:(h+1).toString(),htmlElement:p[0].closest(".binary-select__char"),isOK:u===n[h],actualChar:u}});if(a.onHouseChange(S),a.isFreeMode){e.updatePreview(a.preview,o);return}g!==n?r.postToPg({event:"FAILURE",message:"¡Oh no! Esa no es la palabra correcta. Inténtalo de nuevo.",reasons:[],state:JSON.stringify({selectors:c})}):r.postToPg({event:"SUCCESS",message:"Bien hecho! Has encontrado la letra correcta.",reasons:[],state:JSON.stringify({selectors:c})}),e.updatePreview(a.preview,o)});let s=[];r.getValues(),(i=r.data.state)!=null&&i.selectors?s=r.data.state.selectors.match(/.{1,2}/g):s=e.wordToBinaryString(a.initialWord?a.initialWord.toUpperCase():n.replace(/[A-Z]/g,"?")).match(/.{1,2}/g),e.setBinarySelects(a.container,s),e.updatePreview(a.preview,s)},_=a=>{b({expectedWord:"?".repeat(a.housesAmount),isFreeMode:!0,container:a.container,preview:a.preview,onHouseChange:a.onHouseChange})};export{b as C,_ as F};
