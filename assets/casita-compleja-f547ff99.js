import{P as f}from"./pg-event-f7ab3da9.js";class v{constructor(t,s){this.expectedWord=t,this.availableChars=s}createUI(t,s,a,n){const r=a.flat().join(""),c=this.binaryStringToWord(r).split("");this.generateBinarySelects(t,n),this.createPreview(s,c)}binaryStringToChar(t){const s=parseInt(t,2);return this.availableChars[s]!==void 0?this.availableChars[s]:"_"}getBitsNeeded(){return Math.ceil(Math.log2(this.availableChars.length))}binaryStringToWord(t){const s=this.getBitsNeeded(),a=[];for(let n=0;n<t.length;n+=s){const r=t.slice(n,n+s);a.push(this.binaryStringToChar(r))}return a.join("")}wordToBinaryString(t){const s=this.getBitsNeeded(),a=[];for(const n of t){const r=n,c=this.availableChars.indexOf(r).toString(2).padStart(s,"0");a.push(c)}return a.join("")}getBinaryStringFromSelects(t){const s=t.querySelectorAll(".binary-select__select"),a=this.getBitsNeeded(),n=[];for(let r=0;r<s.length;r+=a){const o=[];for(let c=0;c<a;c++)o.push(s[r+c].value);n.push(o)}return n}createPreview(t,s){s.map(a=>{const n=document.createElement("div");n.classList.add("char-preview");const r=document.createElement("span");r.classList.add("char-preview__char"),r.textContent=a,n.appendChild(r),t.appendChild(n)})}updatePreview(t,s){const a=s.flat().join(""),r=this.binaryStringToWord(a).split(""),o=t.querySelectorAll(".char-preview__char");r.forEach((c,u)=>{o[u].textContent=c})}generateBinarySelects(t,s){this.expectedWord.split("").map(n=>{const r=document.createElement("div");r.classList.add("binary-select__char");const o=this.getBitsNeeded();for(let c=0;c<o;c++){const u=document.createElement("select");u.classList.add("binary-select__select"),["0","1"].forEach(h=>{const p=document.createElement("option");p.value=h,p.text=h,u.appendChild(p)}),u.addEventListener("change",h=>{this.toggleSelect(u),s(this.getBinaryStringFromSelects(t))}),r.appendChild(u)}t.appendChild(r)})}toggleSelect(t){t.value==="1"?t.classList.add("binary-select__select--selected"):t.classList.remove("binary-select__select--selected")}setBinarySelects(t,s){const a=t.querySelectorAll(".binary-select__select");for(let n=0;n<s.length;n++){const r=s[n];for(let o=0;o<r.length;o++)a[n*r.length+o].value=r[o]}a.forEach(n=>{this.toggleSelect(n)})}}const w=e=>{var t,s;return((t=e==null?void 0:e.data)==null?void 0:t.data)&&((s=e==null?void 0:e.data)==null?void 0:s.type)==="init"&&typeof e.data.data=="string"};async function _(e=5e3){return new Promise(t=>{const s=setTimeout(()=>{window.removeEventListener("message",a),t(null)},e);function a(n){w(n)&&(clearTimeout(s),window.removeEventListener("message",a),t(n.data.data))}window.addEventListener("message",a)})}const B=async e=>{var p;const t="¡Bien hecho! Has encontrado la letra correcta.",s="¡Oh no! Esa no es la palabra correcta. Inténtalo de nuevo.",a=["?","A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n=e.expectedWord.toUpperCase(),r=new f,o=new v(n,a),c=i=>{const l=o.getBitsNeeded();return Array.from({length:Math.ceil(i.length/l)},(g,d)=>{const S=Array.from(i).slice(d*l,(d+1)*l),y=o.binaryStringToChar(S.map(C=>C.value).join(""));return{index:(d+1).toString(),htmlElement:S[0].closest(".binary-select__char"),isOK:y===n[d],actualChar:y}})},u=async i=>{console.log(i);const l=i.flat().join(""),g=o.binaryStringToWord(l);if(e.onHouseChange){const y=e.container.querySelectorAll(".binary-select__select"),C=c(y);e.onHouseChange(C)}if(e.isFreeMode){o.updatePreview(e.preview,i);return}const d=g!==n?"FAILURE":"SUCCESS",S=g!==n?e.failureMessage||s:e.successMessage||t;r.postToPg({event:d,message:S,reasons:[],state:JSON.stringify({selectors:l})}),o.updatePreview(e.preview,i)};r.getValues();let b=await _(),h;if(b){let i=JSON.parse(b);if(i.data!=="not-started"&&i.selectors){const l=i.selectors,g=o.getBitsNeeded();h=[];for(let d=0;d<l.length;d+=g){const S=l.substring(d,d+g).split("");h.push(S)}}}if(!h){const i=o.wordToBinaryString(((p=e.initialWord)==null?void 0:p.toUpperCase())||n.replace(/[A-Z]/g,"?")),l=o.getBitsNeeded();h=[];for(let g=0;g<i.length;g+=l){const d=i.slice(g,g+l).split("");h.push(d)}}if(o.createUI(e.container,e.preview,h,u),o.setBinarySelects(e.container,h),o.updatePreview(e.preview,h),e.onHouseChange){const i=e.container.querySelectorAll(".binary-select__select"),l=c(i);e.onHouseChange(l)}},W=e=>{B({expectedWord:"?".repeat(e.housesAmount),isFreeMode:!0,container:e.container,preview:e.preview,onHouseChange:e.onHouseChange})};export{B as C,W as F};
